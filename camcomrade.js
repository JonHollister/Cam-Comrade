const assets = {
    red: {
        asset: "assets/red.png",
        score: 0.85,
        mask: "assets/red_mask.png",
        limit: 20
    },
    start: {
        asset: "assets/start.png",
        score: 0.9,
        mask: "assets/start_mask.png",
        limit: 1
    },
    ex: {
        asset: "assets/start_x.png",
        score: 0.95,
        mask: "assets/start_x_mask.png",
        limit: 1
    }
 }
 
class Asset {
    constructor(ref_in, score_in, alpha_in, limit_in) {
        this.ref =  path(ref_in);
        this.mask = alpha_in ? alpha_in : null;
        this.score = score_in;
    }
}
 
/*const assets = Array.of(
    ud: {
        asset: path("ud"),
        
        }*/

const tw = {
    usn: Config.getValue("tw_usn"), 
    pass: Config.getValue("tw_pass"), 
    post: Config.getValue("tw_post")
};
const chat = {
    chan: Config.getValue("chat_chan"), 
    pass: Config.getValue("chat_pass")
};
const scrn = {
    x: Config.getValue("screen_x"), 
    y: Config.getValue("screen_y"), 
    rect_color: Config.getValue("rect_clr"), 
    rect_pix: Config.getValue("rect_px")
};
const adv = {
    dbg: Config.getValue("debug_do"), 
    tick: Config.getValue("tick"), 
    pak: Config.getValue("package"), 
    take_names: Config.getValue("take_names"), 
    take_pics: Config.getValue("take_pics")
};

if (Android.connected()) {
    Helper.log("Emulator connected!");
    Helper.sleep(2);
    Helper.log("Searching for game package...");
    Helper.sleep(1);
    if (Android.startApp(adv.pak)) {
        Helper.log("Game package found! Initializing surveillance system...");
        main();
    } else {
        Helper.log("Opening game package...");
        Android.startApp(adv.pak);
    }
} else {
    Helper.log("Waiting for emulator connection...");
}

function main() {
    while (state == "active") {
        var mt = scan(assets);
        Helper.msleep(2000);
    }
}


function scan(targets) {
    let haystack = Android.takeScreenshot();
    for (var img_data in targets) {
        if (object.hasOwnProperty(img_data)) {
            let needle = new Image(img_data.asset);
            let mask = new Image(img_data.mask);
            let thresh = img_data.score;
            let lim = img_data.limit;
            var matches = Vision.findMaskedMatches(haystack, needle, mask, thresh, lim);
        }
        if (matches) {
            if (adv.take_names == "pics_mark") {
                var flag_foes = Vision.markMatches(haystack, matches, mk_color, mk_px);
                let mk_color = new Color(scrn.rect_color);
                let mk_px = scrn.rect_pix;
                let date_time = new Date().toISOString();
                let loca = path(date_time, "mugshots");
                flag_foes.saveImage(loca);
                Helper.log(`Saved matches to ${loca}`);
            } else {
                Helper.log("Match made but no record kept");
            }
        } else {
            continue;
        }
            /*if (adv.take_names == "pics_mark") {
                let mk_color = new Color(scrn.rect_color);
                let mk_px = scrn.rect_pix;
                let flag_foes = Vision.markMatches(haystack, matches, mk_color, mk_px);
                let date_time = new Date().toISOString();
                flag_foes.saveImage(path(date_time, "mugshots"));
            }
        }*/
    }
    return matches;
}

function path(insert, folder = "assets") {
    return `${folder}/${insert}.png`;
}











/*const img = {
   red: {
       asset: "assets/red.png",
       score: 0.95,
       mask: "assets/red_mask.png"
   },
   start: {
       asset: "assets/start.png",
       score: 0.9,
       mask: "assets/start_mask.png"
   },
   ex: {
       asset: "assets/start_x.png",
       score: 0.95,
       mask: "assets/start_x_mask.png"
   }
}

class asset {
    constructor(rgb, alpha, score) {
        this.rgb = rgb;
        if (alpha) {
            this.alpha = alpha;
        } else {
            this.alpha = null;0
        }
        this.alpha = alpha;
        this.score = score;
    }
}

/*class contact {
    constructor(trace) {
        this.
    }
}

 

const tw = {usn: Config.getValue("tw_usn"), pass: Config.getValue("tw_pass"), post: Config.getValue("tw_post")};
const chat = {chan: Config.getValue("chat_chan"), pass: Config.getValue("chat_pass")};
const scrn = {x: Config.getValue("screen_x"), y: Config.getValue("screen_y"), rect_color: Config.getValue("rect_clr"), rect_pix: Config.getValue("rect_px")};
const adv = {dbg: Config.getValue("debug_do"), tick: Config.getValue("tick"), pak: Config.getValue("package"), take_names: Config.getValue("take_names"), take_pics: Config.getValue("take_pics")};
var echoes_state = 

if (Android.connected()) {
    Helper.log("Emulator connected!");
    Helper.msleep(2000);
    Helper.log("Searching for game package...");
    if (Android.startApp(adv.pak)) {
        Helper.log("Game package found! Initializing surveillance system...");
        main();
    } else {
        Helper.log("Opening game package...");
        Android.startApp(adv.pak);
    }
} else {
    Helper.log("Waiting for emulator connection...");
}

function main () {
    

    
}

function scan (assets) {
    var sshot = Android.takeScreenshot();
    var matches = [];
    for (var key in assets) {
        var img = assets[key].asset;
        var score = assets[key].score;
        var mask = assets[key].mask;
        matches[key] = new Vision.findMatches(img, sshot, score);
    }
    return matches;
}

*/









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































